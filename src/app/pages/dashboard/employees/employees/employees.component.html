<app-page-heading [title]="'الموظفين'" [subtitle]="'الموظفين'"></app-page-heading>


<form action="" class="forms_dashboard" [formGroup]="employeesData" (ngSubmit)="onSubmit()">
    <div class="row">
        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                <label for="nameEmp" class="form-label">الاسم</label>
                <input type="text" class="form-control" id="nameEmp" maxlength="40" placeholder="الاسم"
                    formControlName="Name">
                <ng-container *ngIf="employeesData.controls['Name'].invalid && employeesData.controls['Name'].touched">
                    <small *ngIf="employeesData.controls['Name'].hasError('required')" class="error_msg_form">الاسم
                        مطلوب</small>
                    <small *ngIf="employeesData.controls['Name'].hasError('minlength')" class="error_msg_form">يجب الاسم
                        ان يتكون من 3 حروف علي الاقل</small>

                </ng-container>
            </div>
        </div>
        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                <label for="nationality" class="form-label">الجنسيه</label>
                <ng-select [items]="dataNationality" bindLabel="nationality_ar" bindValue="nationality_ar"
                    formControlName="Nationality" placeholder="الجنسيه"></ng-select>
                <ng-container
                    *ngIf="employeesData.controls['Nationality'].invalid && employeesData.controls['Nationality'].touched">
                    <small *ngIf="employeesData.controls['Nationality'].hasError('required')"
                        class="error_msg_form">الجنسيه مطلوبه</small>


                </ng-container>
            </div>
        </div>


        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                <label for="phoneEmp" class="form-label">رقم الجوال</label>
                <!-- <input type="text" class="form-control" id="phoneEmp" placeholder="رقم الجوال" formControlName="Mobile">
                           <ng-container *ngIf="employeesData.controls['Mobile'].invalid && employeesData.controls['Mobile'].touched">
                        <small *ngIf="employeesData.controls['Mobile'].hasError('required')" class="error_msg_form">رقم الجوال مطلوب</small>
                        <small *ngIf="employeesData.controls['Mobile'].hasError('saudiPhoneInvalid')" class="error_msg_form">{{this.employeesData.controls['Mobile'].getError('saudiPhoneInvalid')}}</small>
                    </ng-container> -->
                <ngx-intl-tel-input [cssClass]="'form-control'" [onlyCountries]="['sa', 'eg']"
                    [selectedCountryISO]="selectedCountry" [enableAutoCountrySelect]="true" [enablePlaceholder]="true"
                    [selectFirstCountry]="false" [separateDialCode]="true" [maxLength]="14" formControlName="Mobile">
                </ngx-intl-tel-input>
                <ng-container
                    *ngIf="employeesData.controls['Mobile'].invalid && employeesData.controls['Mobile'].touched">
                    <small class="error_msg_form" *ngIf="employeesData.controls['Mobile'].hasError('required')">
                        رقم الجوال مطلوب
                    </small>

                    <small class="error_msg_form" *ngIf="employeesData.controls['Mobile'].hasError('invalidPhone')">
                        {{ employeesData.controls['Mobile'].getError('invalidPhone') }}
                    </small>
                </ng-container>
            </div>
        </div>
        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                <label for="emailEmp" class="form-label">البريد الالكتروني</label>
                <input type="email" class="form-control" id="emailEmp" placeholder="البريد الالكتروني"
                    formControlName="Email">
                <ng-container
                    *ngIf="employeesData.controls['Email'].invalid && employeesData.controls['Email'].touched">
                    <small *ngIf="employeesData.controls['Email'].hasError('inValidEmail')" class="error_msg_form"> {{
                        employeesData.get('Email')?.errors?.['inValidEmail'] }}</small>
                </ng-container>
            </div>
        </div>
        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                <label for="address" class="form-label">العنوان</label>
                <input type="text" class="form-control" maxlength="50" id="address" placeholder="العنوان"
                    formControlName="Address">
                <ng-container
                    *ngIf="employeesData.controls['Address'].invalid && employeesData.controls['Address'].touched">
                    <small *ngIf="employeesData.controls['Address'].hasError('required')" class="error_msg_form">العنوان
                        مطلوب</small>
                    <small *ngIf="employeesData.controls['Address'].hasError('minlength')" class="error_msg_form">يجب
                        العنوان ان يتكون من 3 حروف علي الاقل</small>
                </ng-container>
            </div>
        </div>
        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                <label for="idNational" class="form-label">رقم الهويه</label>
                <input type="text" class="form-control" id="idNational" placeholder="رقم الهويه" maxlength="10"
                    formControlName="NationalID" formControlName="NationalID">
                <ng-container
                    *ngIf="employeesData.controls['NationalID'].invalid && employeesData.controls['NationalID'].touched">
                    <small *ngIf="employeesData.controls['NationalID'].hasError('required')" class="error_msg_form">رقم
                        الهويه مطلوب</small>
                    <small *ngIf="employeesData.controls['NationalID'].hasError('minlength')" class="error_msg_form">يجب
                        رقم الهويه ان يتكون من 10 رقم</small>
                </ng-container>
            </div>
        </div>
        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                <label for="salary" class="form-label">الراتب</label>
                <input type="text" class="form-control" appNoStringPaste maxlength="15" id="salary" placeholder="الراتب"
                    formControlName="Salary">
                <ng-container
                    *ngIf="employeesData.controls['Salary'].invalid && employeesData.controls['Salary'].touched">
                    <small *ngIf="employeesData.controls['Salary'].hasError('required')" class="error_msg_form">رقم
                        الهويه مطلوب</small>
                </ng-container>
            </div>
        </div>
        <div class="col-sm-12 col-lg-3">
            <app-input-attachments (sendDataFiles)="OnDataFiles($event)" [nameFiles]="dataFiles"
                (idRemoveFiles)="fnIdRemoveFiles($event)"></app-input-attachments>
        </div>
    </div>
    <div class="btn_add_reset">
        <button type="sumbit" data-button="send"
            [ngClass]="{'btnEdit':this.btnAddandUpdate=='update','btnAdd':this.btnAddandUpdate=='add'}">{{this.btnAddandUpdate
            =='add' ? 'اضافه' : 'تعديل'}}</button>
        <button type="reset" data-button="reset" (click)="btnAddandUpdate='add'">جديد</button>
    </div>
</form>

<div class="table-responsive">
    <table>
        <thead>
            <tr>
                <th>م</th>
                <th>اسم الموظف</th>
                <th>رقم الجوال</th>
                <th>رقم الهويه</th>
                <th>الادوات</th>
            </tr>
        </thead>
        <tbody>
            @for (item of empData.rows; track $index) {
            <tr>
                <td>{{ ((pageIndex - 1) * pageSize) + ($index + 1) }}</td>
                <td>{{item.name}}</td>
                <td><span dir="ltr">{{item.mobile}}</span></td>
                <td>{{item.nationalID}}</td>
                <td class="d-flex align-items-center justify-content-center" style="    margin-top: 5px;">
                    <div class="btn_edit" (click)="getDataUpdate(item.id)">
                        <button type="button" data-button="edit"><svg width="33" height="26" viewBox="0 0 33 26"
                                fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect y="0.5" width="33.0001" height="25.0001" rx="2" fill="#E0ECE1" />
                                <path
                                    d="M11 8.5H10C9.46957 8.5 8.96086 8.71071 8.58579 9.08579C8.21071 9.46086 8 9.96957 8 10.5V19.5C8 20.0304 8.21071 20.5391 8.58579 20.9142C8.96086 21.2893 9.46957 21.5 10 21.5H19C19.5304 21.5 20.0391 21.2893 20.4142 20.9142C20.7893 20.5391 21 20.0304 21 19.5V18.5"
                                    stroke="#16601A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <path
                                    d="M20 6.50011L23 9.50011M24.385 8.08511C24.7788 7.69126 25.0001 7.15709 25.0001 6.60011C25.0001 6.04312 24.7788 5.50895 24.385 5.11511C23.9912 4.72126 23.457 4.5 22.9 4.5C22.343 4.5 21.8088 4.72126 21.415 5.11511L13 13.5001V16.5001H16L24.385 8.08511Z"
                                    stroke="#16601A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                    <div class="btn_delete" (click)="getDataDelete(item.id)">
                        <button type="button" data-button="delete" class="border-0 "><svg width="33" height="26"
                                viewBox="0 0 33 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect y="0.5" width="33" height="25" rx="2" fill="#FFE5E5" />
                                <path
                                    d="M23.5 5H20L19 4H14L13 5H9.5V7H23.5M10.5 20C10.5 20.5304 10.7107 21.0391 11.0858 21.4142C11.4609 21.7893 11.9696 22 12.5 22H20.5C21.0304 22 21.5391 21.7893 21.9142 21.4142C22.2893 21.0391 22.5 20.5304 22.5 20V8H10.5V20Z"
                                    fill="#FF3D00" />
                            </svg>
                        </button>
                    </div>
                </td>
            </tr>
            }@empty {
            <tr>
                <td class="empty-cell" colspan="5">
                    <app-emptytable></app-emptytable>
                </td>
            </tr>
            }
        </tbody>
    </table>
</div>

<app-pagination [totalPages]="this.empData.paginationInfo?.totalPagesCount" [currentPage]="pageIndex"
    (pageChange)="onPageChanged($event)">
</app-pagination>

<app-confirm-delete [isVisible]="showDelete" (onDelete)="deleteConfirmed($event)" [itemId]="this.deleteId"
    (toggleModal)="onClose()"></app-confirm-delete>
<app-page-heading [title]="title" [subtitle]="subtitle"></app-page-heading>

<form  class="forms_dashboard" appScrollAnimation="fade-in" [formGroup]="BrokerData" (ngSubmit)="onSubmit()">
    <div class="row">
        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                    <label for="nameRealtor" class="form-label">الاسم</label>
                    <input type="text" class="form-control" id="nameRealtor" maxlength="40" placeholder="الاسم" formControlName="Name">
                      <ng-container *ngIf="BrokerData.controls['Name'].invalid && BrokerData.controls['Name'].touched">
                        <small class="error_msg_form" *ngIf="BrokerData.controls['Name'].hasError('required')" >الاسم مطلوب</small>
                        <small class="error_msg_form" *ngIf="BrokerData.controls['Name'].hasError('minlength')">يجب ان يكون الاسم اكثر من 3 حروف</small>
                        <small class="error_msg_form" *ngIf="BrokerData.controls['Name'].hasError('invalidUsername')">{{BrokerData.get('Name')?.errors?.['invalidUsername']}}</small>
                        <small class="error_msg_form" *ngIf="BrokerData.controls['Name'].hasError('invalidStart')">{{BrokerData.get('Name')?.errors?.['invalidStart']}}</small>
                    </ng-container>
            </div>
        </div>
        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                    <label for="nameRealtor" class="form-label">حساب الاب</label>
                    <ng-select [items]="accountParent" bindLabel="name" bindValue="id" [virtualScroll]="true" placeholder="اسم الحساب" formControlName="parentId"></ng-select>
                      <ng-container *ngIf="BrokerData.controls['parentId'].invalid && BrokerData.controls['parentId'].touched">
                        <small class="error_msg_form" *ngIf="BrokerData.controls['parentId'].hasError('required')" >حساب الاب مطلوب</small>
                    </ng-container>
            </div>
        </div>


        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                    <label for="phoneRealtor" class="form-label">رقم الجوال</label>
                    <ngx-intl-tel-input [cssClass]="'form-control'" [onlyCountries]="['sa', 'eg']"
                     [selectedCountryISO]="selectedCountry"
                    [enableAutoCountrySelect]="true" [enablePlaceholder]="true" 
                    [selectFirstCountry]="false" [separateDialCode]="true" [maxLength]="10" formControlName="Mobile">
                </ngx-intl-tel-input>
                <ng-container *ngIf="BrokerData.controls['Mobile'].invalid && BrokerData.controls['Mobile'].touched">
                    <small class="error_msg_form" *ngIf="BrokerData.controls['Mobile'].hasError('required')">
                        رقم الجوال مطلوب
                    </small>

                    <small class="error_msg_form" *ngIf="BrokerData.controls['Mobile'].hasError('invalidPhone')">
                        {{ BrokerData.controls['Mobile'].getError('invalidPhone') }}
                    </small>
                </ng-container> 
                    <!-- <input type="text" class="form-control" id="phoneRealtor" placeholder="رقم الجوال" appNoStringPaste formControlName="Mobile">
              <ng-container *ngIf="BrokerData.controls['Mobile'].invalid && BrokerData.controls['Mobile'].touched">
                        <small class="error_msg_form" *ngIf="BrokerData.controls['Mobile'].hasError('required')" >رقم الجوال مطلوب</small>
                        <small class="error_msg_form" *ngIf="BrokerData.controls['Mobile'].hasError('saudiPhoneInvalid')" >
                            {{ BrokerData.controls['Mobile'].getError('saudiPhoneInvalid') }}
                        </small>
                    </ng-container>  -->
                </div>
             
        </div>
        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                    <label for="nationality" class="form-label">الجنسيه</label>
                    <ng-select [items]="dataNationality" bindLabel="nationality_ar" bindValue="nationality_ar" placeholder="الجنسيه" formControlName="Nationality"></ng-select>
                     <ng-container *ngIf="BrokerData.controls['Nationality'].invalid && BrokerData.controls['Nationality'].touched">
                        <small class="error_msg_form" *ngIf="BrokerData.controls['Nationality'].hasError('required')" >الجنسيه مطلوبه</small>
                       
                    </ng-container> 
            </div>
        </div>


           <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                    <label for="bounsRealtor" class="form-label">البونص</label>
                    <input type="text" class="form-control" id="bounsRealtor" maxlength="10" placeholder="قيمه" formControlName="Bonus" appNoStringPaste>
                      <ng-container *ngIf="BrokerData.controls['Bonus'].invalid && BrokerData.controls['Bonus'].touched">
                        <small class="error_msg_form" *ngIf="BrokerData.controls['Bonus'].hasError('required')" >البونص مطلوب</small>

                    </ng-container>
            </div>
        </div>

        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                    <label for="IdReator" class="form-label">رقم الهويه</label>
                    <input type="email" class="form-control" appNoStringPaste maxlength="10" id="IdReator" placeholder="رقم الهويه" formControlName="NationalID">
                      <ng-container *ngIf="BrokerData.controls['NationalID'].invalid && BrokerData.controls['NationalID'].touched">
                        <small class="error_msg_form" *ngIf="BrokerData.controls['NationalID'].hasError('required')" >رقم الهويه مطلوب</small>
                        <small class="error_msg_form" *ngIf="BrokerData.controls['NationalID'].hasError('minlength')" >
                           يجب ان يكون رقم الهويه 10 ارقام
                        </small>
                         <small class="error_msg_form" *ngIf="BrokerData.controls['NationalID'].hasError('nationalIDExists')">
    {{ BrokerData.controls['NationalID'].getError('nationalIDExists') }}
  </small>

                    </ng-container>
            </div>
        </div>
        <div class="col-sm-12 col-lg-3">
            <div class="mb-3">
                    <label for="email" class="form-label">البريد الالكتروني</label>
                    <input type="email" class="form-control" id="email" placeholder="البريد الالكتروني" formControlName="Email">
                        <ng-container *ngIf="BrokerData.controls['Email'].invalid && BrokerData.controls['Email'].touched">
                        <small class="error_msg_form" *ngIf="BrokerData.controls['Email'].hasError('inValidEmail')" >{{BrokerData.get('Email')?.errors?.['inValidEmail']}}</small>
                    </ng-container>
            </div>
        </div>
        <div class="col-sm-12 col-lg-3">
            <app-input-attachments (sendDataFiles)="OnDataFiles($event)" [nameFiles]="dataFiles" (idRemoveFiles)="fnIdRemoveFiles($event)"></app-input-attachments>
        </div>


    </div>


    <div class="btn_add_reset">
        <button type="sumbit" data-button="send" [ngClass]="{'btnEdit':this.btnAddandUpdate=='update','btnAdd':this.btnAddandUpdate=='add'}">{{btnAddandUpdate == 'add' ? 'اضافه' : 'تعديل'}}</button>
        <button type="reset" data-button="reset" (click)="resetData()">جديد</button>
    </div>

</form>


<div class="table-responsive">
    <table>
        <thead>
            <tr>
                <th>م</th>
                <th>اسم السمسار</th>
                <th>رقم الجوال</th>
                <th>البونص</th>
                <th>الادوات</th>
            </tr>
        </thead>
        <tbody>
      @for (item of realtorData.rows; track $index) {
        <tr>
            <td>{{ ((pageIndex - 1) * pageSize) + ($index + 1) }}</td>
            <td>{{item.name}}</td>
            <td><span dir="ltr">{{item.mobile}}</span></td>
            <td>{{item.bonus}}</td>
            <td>
                <div class="btn_edit">
                    <button type="button" (click)="getUpdateData(item.id)" data-button="edit"><svg width="33" height="26" viewBox="0 0 33 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect y="0.5" width="33.0001" height="25.0001" rx="2" fill="#E0ECE1"/>
<path d="M11 8.5H10C9.46957 8.5 8.96086 8.71071 8.58579 9.08579C8.21071 9.46086 8 9.96957 8 10.5V19.5C8 20.0304 8.21071 20.5391 8.58579 20.9142C8.96086 21.2893 9.46957 21.5 10 21.5H19C19.5304 21.5 20.0391 21.2893 20.4142 20.9142C20.7893 20.5391 21 20.0304 21 19.5V18.5" stroke="#16601A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M20 6.50011L23 9.50011M24.385 8.08511C24.7788 7.69126 25.0001 7.15709 25.0001 6.60011C25.0001 6.04312 24.7788 5.50895 24.385 5.11511C23.9912 4.72126 23.457 4.5 22.9 4.5C22.343 4.5 21.8088 4.72126 21.415 5.11511L13 13.5001V16.5001H16L24.385 8.08511Z" stroke="#16601A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</button>
                    <button type="button" data-button="delete" (click)="showDeletePopup(item.id)"><svg width="33" height="26" viewBox="0 0 33 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect y="0.5" width="33" height="25" rx="2" fill="#FFE5E5"/>
<path d="M23.5 5H20L19 4H14L13 5H9.5V7H23.5M10.5 20C10.5 20.5304 10.7107 21.0391 11.0858 21.4142C11.4609 21.7893 11.9696 22 12.5 22H20.5C21.0304 22 21.5391 21.7893 21.9142 21.4142C22.2893 21.0391 22.5 20.5304 22.5 20V8H10.5V20Z" fill="#FF3D00"/>
</svg>
</button>
                </div>
            </td>
        </tr>
      }@empty {
               <tr>
    <td class="empty-cell" colspan="5">
     <app-emptytable></app-emptytable>
    </td>
  </tr>
      }
        </tbody>
    </table>
</div>


<app-pagination
*ngIf="realtorData.rows.length > 0"
  [totalPages]="realtorData.paginationInfo?.totalPagesCount"
  [currentPage]="pageIndex"
  (pageChange)="onPageChanged($event)">
</app-pagination>


<app-confirm-delete [isVisible]="showDelete" (onDelete)="deleteConfirmed($event)" [itemId]="this.deleteId" (toggleModal)="onClose()"></app-confirm-delete>
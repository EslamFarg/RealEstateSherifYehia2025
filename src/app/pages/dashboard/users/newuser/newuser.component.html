<app-page-heading [title]="'المستخدمين'" [subtitle]="'مستخدم جديد'"></app-page-heading>


<form action="" class="forms_dashboard" [formGroup]="formData" (ngSubmit)="onSubmit()">
    <div class="row">
        <div class="col-sm-12">
            <div class="mb-3">
            <label for="nameuser" class="form-label">اسم المستخدم</label>
            <input type="text" maxlength="40" class="form-control" id="nameuser" placeholder="اسم المستخدم" formControlName="userName">  
                    <ng-container *ngIf="formData.controls['userName'].invalid && formData.controls['userName'].touched">
                        <small class="error_msg_form" *ngIf="formData.controls['userName'].hasError('required')" >اسم المستخدم مطلوب</small>
                        <small class="error_msg_form" *ngIf="formData.controls['userName'].hasError('minlength')">يجب ان يكون اسم المستخدم اكثر من 3 حروف</small>
                        <small class="error_msg_form" *ngIf="formData.controls['userName'].hasError('invalidUsername')"> رجاءً اكتب اسم المستخدم بشكل صحيح — يُسمح فقط بالحروف الإنجليزية، الأرقام، النقطة (.)، والشرطة السفلية (_)</small>
                     </ng-container>
            </div>
       
        </div>
        <div class="col-sm-12 col-lg-6">
            <div class="mb-3">
            <label for="phonenumber" maxlength="20" class="form-label">رقم الجوال</label>
            <input type="text" appNoStringPaste  maxlength="14" class="form-control" id="phonenumber" placeholder="رقم الجوال" formControlName="phoneNumber"> 
            <ng-container *ngIf="formData.controls['phoneNumber'].invalid && formData.controls['phoneNumber'].touched">
                   <small class="error_msg_form" *ngIf="formData.controls['phoneNumber'].hasError('required')" >رقم الجوال مطلوب</small>
                    

            </ng-container>
                    
            </div>
       
        </div>
        <div class="col-sm-12 col-lg-6">
            <div class="mb-3">
            <label for="email" class="form-label">البريد الالكتروني</label>
            <input type="email" class="form-control" id="email" placeholder="البريد الالكتروني" formControlName="email">  
            <ng-container *ngIf="formData.controls['email'].invalid && formData.controls['email'].touched">
                <small class="error_msg_form" *ngIf="formData.controls['email'].hasError('required')" >البريد الالكتروني مطلوب</small>
                <small class="error_msg_form" *ngIf="formData.controls['email'].hasError('email')" >صيغة البريد الالكتروني غير صحيحة</small>
            </ng-container>       
            </div>
       
        </div>
        <div class="col-sm-12 col-lg-6">
            <div class="mb-3">
                <app-refresh-select [titleLabel]="'المجموعه'"></app-refresh-select>
            </div>
       
        </div>
        <div class="col-sm-6" style="align-self: center;">
            <div class="mb-3">
                <label for="statususer" class="form-label">حاله المستخدم</label>
                <div class="parent_checkbox d-flex align-items-center gap-2">
                        <input type="checkbox"  checked class="checkedBox_shared" id="statususer" formControlName="isActive">
                        <label for="statususer">نشط</label>
                </div>
              
            </div>
       
        </div>

    </div>

    <div class="btn_add_reset">
        <button type="sumbit" data-button="send" [ngClass]="{'btnEdit':this.btnAddAndUpdate=='update','btnAdd':this.btnAddAndUpdate=='add'}">{{btnAddAndUpdate == 'add' ? 'اضافه' : 'تعديل'}}</button>
        <button type="reset" data-button="reset">جديد</button>
    </div>
</form>



<div class="table-responsive">
    <table>
        <thead>
            <tr>
                <th>م</th>
                <th>اسم المستخدم</th>
                <th>المجموعه</th>
                <th>البريد الالكتروني</th>
                <th>رقم الجوال</th>
                <th>حاله المستخدم</th>
                <th>الادوات</th>
            </tr>
        </thead>
        <tbody>
      @for (item of getAllData; track $index) {
        <tr>
            <td>{{$index+1}}</td>
            <td>{{item.userName}}</td>
            <td>{{item.groupName || 'لايوجد اسم مجموعه'}}</td>
            <td>{{item.email    }}</td>
            <td>{{item.phoneNumber}}</td>
            <td>{{item.isActive ? 'نشط' : 'غير نشط'}}</td>
            <td>
                <div class="btn_edit">
                    <button type="button" data-button="edit" (click)="getUpdateData(item.userId)"><svg width="33" height="26" viewBox="0 0 33 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect y="0.5" width="33.0001" height="25.0001" rx="2" fill="#E0ECE1"/>
<path d="M11 8.5H10C9.46957 8.5 8.96086 8.71071 8.58579 9.08579C8.21071 9.46086 8 9.96957 8 10.5V19.5C8 20.0304 8.21071 20.5391 8.58579 20.9142C8.96086 21.2893 9.46957 21.5 10 21.5H19C19.5304 21.5 20.0391 21.2893 20.4142 20.9142C20.7893 20.5391 21 20.0304 21 19.5V18.5" stroke="#16601A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M20 6.50011L23 9.50011M24.385 8.08511C24.7788 7.69126 25.0001 7.15709 25.0001 6.60011C25.0001 6.04312 24.7788 5.50895 24.385 5.11511C23.9912 4.72126 23.457 4.5 22.9 4.5C22.343 4.5 21.8088 4.72126 21.415 5.11511L13 13.5001V16.5001H16L24.385 8.08511Z" stroke="#16601A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</button>
                    <button type="button" data-button="delete" (click)="deleteModel(item.userId)"><svg width="33" height="26" viewBox="0 0 33 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect y="0.5" width="33" height="25" rx="2" fill="#FFE5E5"/>
<path d="M23.5 5H20L19 4H14L13 5H9.5V7H23.5M10.5 20C10.5 20.5304 10.7107 21.0391 11.0858 21.4142C11.4609 21.7893 11.9696 22 12.5 22H20.5C21.0304 22 21.5391 21.7893 21.9142 21.4142C22.2893 21.0391 22.5 20.5304 22.5 20V8H10.5V20Z" fill="#FF3D00"/>
</svg>
</button>
                </div>
            </td>
        </tr>
      }@empty {
        
          <tr>
    <td class="empty-cell" colspan="8">
     <app-emptytable></app-emptytable>
    </td>
  </tr>
}

        </tbody>
    </table>
</div>


<app-pagination
  [totalPages]="10"
  [currentPage]="pageIndex"
  (pageChange)="onPageChanged($event)">
</app-pagination>

<app-confirm-delete [isVisible]="showDelete" (onDelete)="deleteConfirmed($event)" [itemId]="this.deleteId" (toggleModal)="onClose()"></app-confirm-delete>
<app-page-heading [title]="'المحاسبه'" [subtitle]="'سند القبض'"></app-page-heading>

<form action="" class="forms_dashboard" [formGroup]="receiptForm" (ngSubmit)="OnSubmit()">
    <div class="row">
        <div class="col-sm-12 col-lg-4 mb-3">
            <label for="numbervoucher" class="form-label">رقم السند</label>
            <input type="text" id="numbervoucher" class="form-control" placeholder="رقم السند" readonly value="0" #NumberVoucher >
        </div>
        <div class="col-sm-12 col-lg-4 mb-3">
            <label for="numbernotes" class="form-label">رقم الرفتري</label>
            <input type="text" class="form-control" id="numbernotes" maxlength="20" placeholder="الرقم الدفتري" formControlName="voucherNo"  style="background-color: #FBFBFB !important;">
            <!-- <ng-container *ngIf="receiptForm.controls['voucherNo'].invalid && receiptForm.controls['voucherNo'].touched">
              <small class="error_msg_form" *ngIf="receiptForm.controls['voucherNo'].hasError('required')">رقم الرفتري مطلوب</small>
              <small class="error_msg_form" *ngIf="receiptForm.controls['voucherNo'].hasError('minlength')">يجب ان يكون رقم الرفتري اكثر من 3 حروف</small>
            </ng-container> -->

            <app-formerror-msg [control]="receiptForm.controls['voucherNo']" [Messages]="{
               required: 'رقم الرفتري مطلوب',
                minlength: 'يجب ان يكون رقم الرفتري اكثر من 3 حروف',
                
            }"    ></app-formerror-msg>

        </div>
        <div class="col-sm-12 col-lg-4 mb-3">
            <label for="date" class="form-label">التاريخ</label>
            <input type="date" class="form-control" id="date" placeholder="التاريخ"  formControlName="voucherDate">
            <app-formerror-msg [control]="receiptForm.controls['voucherDate']" [Messages]="
            {
              required:'التاريخ مطلوب'
            }
            "></app-formerror-msg>
        </div>

        <div class="col-sm-12 col-lg-6 mb-3">
            <label for="" class="form-label">الصندوق / البنك</label>
            <!-- <input type="text"> -->
             <ng-select [items]="getAllDataAccount" bindLabel="name" bindValue="financiallyAccountId"  placeholder="صندوق / بنك" formControlName="debitAccountId"></ng-select>
             <app-formerror-msg [control]="receiptForm.controls['debitAccountId']" [Messages]="{
               required:'الصندوق / البنك مطلوب'

             }"></app-formerror-msg>
        </div>
        <div class="col-sm-12 col-lg-6 mb-3">
            <label for="amount" class="form-label">المبلغ</label>
            <input type="text" class="form-control" id="amount" maxlength="15" placeholder="المبلغ" appNoStringPaste formControlName="amount">
               <app-formerror-msg [control]="receiptForm.controls['amount']" [Messages]="{
               required:'المبلغ مطلوب'
               
             }"></app-formerror-msg>

        </div>

         <div class="col-sm-12 mb-3">
            <label for="" class="form-label">الحساب</label>
            <!-- <input type="text"> -->
             <ng-select [items]="getAllDataFinancialAccount" bindLabel="name" bindValue="id"  placeholder="الحساب" formControlName="creditAccountId"></ng-select>
             <app-formerror-msg [control]="receiptForm.controls['creditAccountId']" [Messages]="{
               required:'الحساب مطلوب'

             }"></app-formerror-msg>
        </div>


          <div class="col-sm-12">
        <div class="mb-3">
            <label for="byan" class="form-label">البيان</label>
            <textarea class="form-control" id="byan" rows="3" placeholder="اكتب المحتوي" style="height: 124px !important;" formControlName="notes"></textarea>
            <app-formerror-msg [control]="receiptForm.controls['notes']" [Messages]="{
               required:'البيان مطلوب'
             }"></app-formerror-msg>
          </div>
    </div>

    </div>

     <div class="btn_add_reset">
 <button type="submit" data-type="save" data-button="send"  [ngClass]="{'btnEdit':this.btnAddandUpdate=='update','btnAdd':this.btnAddandUpdate=='add'}">{{this.btnAddandUpdate == 'add' ? 'اضافه':"تعديل"}}</button>
  </div>
</form>




 <div class="table-responsive">
<table>
  <thead>
    <tr>
      <th scope="col">م</th>
      <th scope="col">رقم السند</th>
      <th scope="col">التاريخ</th>
      <th scope="col">الصندوق / البنك</th>
      <th scope="col">الحساب</th>
      <th scope="col"> المبلغ</th>
      <!-- <th scope="col"> الحاله</th> -->
      <th scope="col">الادوات</th>
      <!-- <th scope="col">Handle</th> -->
    </tr>
  </thead>
  <tbody>
    @for (item of receiptVouchersData.rows; track $index) {
<tr>
      <td scope="row">{{$index + 1}}</td>
      <td>{{item.voucherNo}}</td>
      <td>{{item.voucherDate.split('T')[0]}}</td>
      <td>{{item.debitAccountName}} </td>
      <td>{{item.creditAccountName}}</td>
      <td>{{item.net}}</td>
    
    
       <td>
      
            <div class="btn_edit" >
                    <button type="button" data-button="edit" (click)="getDataUpdate(item.id)"><svg width="33" height="26" viewBox="0 0 33 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect y="0.5" width="33.0001" height="25.0001" rx="2" fill="#E0ECE1"/>
<path d="M11 8.5H10C9.46957 8.5 8.96086 8.71071 8.58579 9.08579C8.21071 9.46086 8 9.96957 8 10.5V19.5C8 20.0304 8.21071 20.5391 8.58579 20.9142C8.96086 21.2893 9.46957 21.5 10 21.5H19C19.5304 21.5 20.0391 21.2893 20.4142 20.9142C20.7893 20.5391 21 20.0304 21 19.5V18.5" stroke="#16601A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M20 6.50011L23 9.50011M24.385 8.08511C24.7788 7.69126 25.0001 7.15709 25.0001 6.60011C25.0001 6.04312 24.7788 5.50895 24.385 5.11511C23.9912 4.72126 23.457 4.5 22.9 4.5C22.343 4.5 21.8088 4.72126 21.415 5.11511L13 13.5001V16.5001H16L24.385 8.08511Z" stroke="#16601A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</button>
                    <button type="button" data-button="delete" (click)="showPopupDelete(item.id)"><svg width="33" height="26" viewBox="0 0 33 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect y="0.5" width="33" height="25" rx="2" fill="#FFE5E5"/>
<path d="M23.5 5H20L19 4H14L13 5H9.5V7H23.5M10.5 20C10.5 20.5304 10.7107 21.0391 11.0858 21.4142C11.4609 21.7893 11.9696 22 12.5 22H20.5C21.0304 22 21.5391 21.7893 21.9142 21.4142C22.2893 21.0391 22.5 20.5304 22.5 20V8H10.5V20Z" fill="#FF3D00"/>
</svg>
</button>
                </div>

       </td>
    </tr>
    }@empty {
               <tr>
    <td class="empty-cell" colspan="9">
     <app-emptytable></app-emptytable>
    </td>
  </tr>
      }

    
  </tbody>
</table>   


</div>

<app-pagination


  [totalPages]="receiptVouchersData.paginationInfo?.totalPagesCount"
  [currentPage]="pageIndex"
  (pageChange)="onPageChanged($event)">
</app-pagination>


<app-confirm-delete [isVisible]="showDelete" (onDelete)="deleteConfirmed($event)" [itemId]="this.deleteId" (toggleModal)="onClose()"></app-confirm-delete>